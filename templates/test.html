<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
        }      
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test</title>
    <script>
        var items = [];
        var arrNames = [];
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.getElementById("table");
            table.oldHTML = table.innerHTML;

            document.querySelector('form').onsubmit = () => {
                input_name = document.querySelector('#test_item').value;
                input_qty = Number(document.querySelector('#test_qty').value);

                for (i in items) {
                    if (items[i].name === input_name) {
                        items[i].qty += input_qty;
                        break;
                    }
                };

                if (!arrNames.includes(input_name)) {
                    let item = {
                        "name": input_name,
                        "qty": input_qty
                        };
                    items.push(item); 
                }

                arrNames.push(input_name)        

                table.innerHTML = table.oldHTML;
                for (item of items) {
                    var row = table.insertRow(table.length);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    cell1.innerHTML = item["name"];
                    cell2.innerHTML = item["qty"];
                    cell3.innerHTML = `<button data-name="${item["name"]}" class="button_reset">Set 0</button>`;
                }

                var data = JSON.stringify(items);

                event.preventDefault();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const serv_btn = document.querySelector('#serv_submit');
            serv_btn.addEventListener('click', function () {
                fetch('/test', {
                    method: 'post',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(items)
                }).then(function (response) {
                    return response.text();    
                }).then(function (text) {
                    console.log(text);
                }).catch(function (error) {
                    console.log(error);
                })   
            })
        });        

    </script>
</head>
<body>

    <form>
        <input type="text" placeholder="item" id="test_item">
        <input type="number" id="test_qty" value="1">
        <input type="submit">
    </form>

    <table id="table">
        <thead>
            <th>item</th>
            <th>qty</th>
        </thead>
        <tbody id="tablebody">
        </tbody>
    </table>

    
    <button id="serv_submit">Server Submit</button>


</body>
</html>

